%{
    Duration Data Analytics for Armand

    This code takes treatment application data (position, duration of treatment, 
    and presence of an error) from a Particle.io Boron, passed from the Labview 
    program controlling a STAR system. It calculates descriptive statistics 
    (mean, standard deviation, minimum, and maximum) for each position based on 
    the last 4500 data observations and plots them.

    Created 15 April 2023
    By Ian Enochs

%}


% Channel ID to read data from 
readChannelID = 2108194; 
% Position Field ID 
positionFieldID = 1; 
% Duration Field ID 
durationFieldID = 2; 

% Channel Read API Key   
% If your channel is private, then enter the read API 
% Key between the '' below:   
readAPIKey = 'R5HNIA1QET8FWR75'; 

data = thingSpeakRead(readChannelID,'Fields',[positionFieldID durationFieldID],'NumPoints',4800, 'ReadKey',readAPIKey,OutputFormat='TimeTable'); 



meanDurationByPosition = groupsummary(data,"position",{"mean","std","min","max"},["duration"]);                                   
disp(meanDurationByPosition);

position = meanDurationByPosition.('position');
durationMean = meanDurationByPosition.('mean_duration');
durationStd = meanDurationByPosition.('std_duration');
durationMax = meanDurationByPosition.('max_duration');
durationMin = meanDurationByPosition.('min_duration');

hold on
% Visualize the data
errorbar(position,durationMean,durationStd, 'LineStyle','none','Marker','.', 'MarkerSize',10);

scatter(position,durationMax,10,'^');
scatter(position,durationMin,10,'v');


%scatter(meanDurationByPosition,"position", "mean_duration");
xlabel('Position');
ylabel('Mean duration'); 
title('Mean duration by position')
hold off
